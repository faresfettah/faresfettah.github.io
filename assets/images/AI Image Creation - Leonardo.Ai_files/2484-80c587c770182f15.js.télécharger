!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},r=Error().stack;r&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[r]="923f099b-7624-41ca-9ec9-97a7f7195bd8",e._sentryDebugIdIdentifier="sentry-dbid-923f099b-7624-41ca-9ec9-97a7f7195bd8")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2484],{74449:function(e,r,t){t.d(r,{C:function(){return o},T:function(){return i}});var n=t(32603);let i=n.I0,o=n.v9},27711:function(e,r,t){let n;t.d(r,{ch:function(){return U},cn:function(){return P},bH:function(){return b},MD:function(){return L}});var i=t(74793),o=t(58759),a=t(51451),l=t(57919),u=t(31574),s=t(37065),d=t.n(s),c=t(80605),E=t(61478),T=t(70949);let p=d()(c.getSession,1e4),_=e=>{if(!e)return!0;let r=(0,T.T)();return(0,l.n)({category:"auth",level:"info",message:"libs/apollo/auth-link.ts - Checking session expiry",data:{accessTokenIssuedAt:e.accessTokenIssuedAt,accessTokenExpiry:e.accessTokenExpiry,serverTimestamp:e.serverTimestamp,error:e.error,refreshDistance:E.Ab}}),e.accessTokenExpiry<r||r-e.accessTokenIssuedAt>E.Ab};var f=t(88789),A=t(32249);let v=null,S=new(t(35114)).W({delay:{initial:500,jitter:!0},attempts:{max:3,retryIf:e=>!!e}}),y="trendingScore",O="likeCount",I=e=>{switch(e){case"trending":return y;case"top":return O;default:return"createdAt"}},R=(e,r)=>{var t,n,i,o,a,l,u;let s=!!(null==e?void 0:null===(t=e.where)||void 0===t?void 0:t._or),d=r=>{var t,n,i;return null==e?void 0:null===(i=e.where._or)||void 0===i?void 0:null===(n=i.find(e=>{var t;return(null==e?void 0:null===(t=e[r])||void 0===t?void 0:t._lt)!==void 0}))||void 0===n?void 0:null===(t=n[r])||void 0===t?void 0:t._lt};switch(r){case"trending":return s?d(y):null==e?void 0:null===(i=e.where)||void 0===i?void 0:null===(n=i.trendingScore)||void 0===n?void 0:n._gt;case"top":return s?d(O):null==e?void 0:null===(a=e.where)||void 0===a?void 0:null===(o=a.likeCount)||void 0===o?void 0:o._gt;default:return null==e?void 0:null===(u=e.where)||void 0===u?void 0:null===(l=u.createdAt)||void 0===l?void 0:l._lt}},N=e=>{var r,t,n,i;let o=JSON.parse(JSON.stringify(e));return null==o||delete o.offset,null==o||delete o.limit,null==o||null===(r=o.where)||void 0===r||delete r.createdAt,null==o||null===(t=o.where)||void 0===t||delete t._or,null==o||null===(n=o.where)||void 0===n||delete n.trendingScore,null==o||null===(i=o.where)||void 0===i||delete i.likeCount,JSON.stringify(o)},g=e=>{var r,t;return(null==e?void 0:null===(r=e.where)||void 0===r?void 0:r.trendingScore)?"trending":(null==e?void 0:null===(t=e.where)||void 0===t?void 0:t.likeCount)?"top":"default"},m=(e,r,t,n)=>{let{args:i,readField:o}=r;return(null==i?void 0:i.offset)?i.offset:void 0!==t&&n?e.findLastIndex(e=>o(n,e)===t)+1:e.length};function P(e){let{keyArgs:r=N,getCursorField:t=e=>I(e),getCursor:n=(e,r)=>R(e,r)}=e||{};return{keyArgs:r,merge(e,r,i){var o;if(!(null===(o=i.variables)||void 0===o?void 0:o.infinite))return r;let a=g(i.args),l=e?e.slice(0).filter(e=>i.canRead(e)):[],u=null==n?void 0:n(i.args,a),s=m(l,i,u,null==t?void 0:t(a));for(let e=0;e<r.length;++e)l[s+e]=r[e];return l}}}let U=(0,i.L)({uri:"https://api.leonardo.ai/v1/graphql"}),h=[(0,a.v)(async e=>{let{headers:r}=e,t=!!n,i=_(n);if(i){var o;n=await (null===(o=p())||void 0===o?void 0:o.catch(e=>((0,u.Tb)(e),(0,l.n)({category:"auth",type:"error",message:"Error during session fetch",data:{error:e.message}}),null)))}if(!n)return(0,l.n)({category:"auth",type:"info",level:"error",message:"libs/apollo/auth-link.ts - Session is undefined or null after throttledGetSession"}),null;let a=null==n?void 0:n.accessToken;if(n){let e="libs/apollo/auth-link.ts - ";t?e+=i?"Session refetched":"Using cached session":e+="Fetched session for the first time (after login or being inactive)",(0,l.n)({category:"auth",type:"info",message:e,data:{accessTokenIssuedAt:n.accessTokenIssuedAt,accessTokenExpiry:n.accessTokenExpiry,serverTimestamp:n.serverTimestamp,error:n.error}})}else(0,l.n)({category:"auth",type:"info",message:"libs/apollo/auth-link.ts - Session is null or undefined"});return{headers:{...r,...a&&{authorization:"Bearer ".concat(a)}}}}),S,(0,A.q)(e=>{let{operation:r,graphQLErrors:t,networkError:n,forward:i}=e;if(t){for(let e of t)if("invalid-jwt"===e.extensions.code)return v||(v=(0,c.getSession)().finally(()=>{v=null})),(0,f.p)(v).flatMap(e=>{let t=null==e?void 0:e.accessToken;return r.setContext(e=>{let{headers:r}=e;return{headers:{...r,...t&&{authorization:"Bearer ".concat(t)}}}}),i(r)})}}),U],w=[S,U],L=(e,r)=>{r?e.setLink((0,o.D)(h)):e.setLink((0,o.D)(w))},k=e=>{let r=0;for(;null==e?void 0:e.left;)e=e.left,r++;return r},b=e=>k(e.link)===(null==h?void 0:h.length)-1},12088:function(e,r,t){t.d(r,{Bx:function(){return s},JG:function(){return d}});var n=t(23952),i=t(58759),o=t(63761),a=t(47230),l=t.n(a),u=t(27711);let s=new n.f({link:(0,i.D)([u.ch]),cache:new o.h({typePolicies:{Query:{fields:{getUniversalUpscalerDrawer:{keyArgs:!1,merge(){var e;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,{readField:n}=arguments.length>2?arguments[2]:void 0,i=[...r.items||[],...t.items||[]];return{__typename:"UniversalUpscalerDrawerOutput",count:null!==(e=t.count)&&void 0!==e?e:r.count,items:l()(i,e=>n("id",e))}}},generated_images:(0,u.cn)()}},loras:{keyFields:["akUUID"]},controlnet_definition:{keyFields:["akUUID"]},generated_image_moderation:{keyFields:["generatedImageId"]},storyboard:{keyFields:["akUUID"]},storyboard_scenes:{keyFields:["akUUID"]},storyboard_scene_generations:{keyFields:["generatedImageId"]},storyboard_style:{keyFields:["akUUID"]},team_deals:{keyFields:["akUUID"]}}})}),{mutate:d}=s;r.ZP=s},61478:function(e,r,t){t.d(r,{Ab:function(){return n},GT:function(){return i}});let n=Math.floor(60*(parseFloat("60")||10)*.8),i="UserNotConfirmedException"},70949:function(e,r,t){t.d(r,{T:function(){return n}});let n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Math.floor(Date.now()/1e3)-e}},66925:function(e,r,t){t.d(r,{J:function(){return n}});let n={ANDROID:"Android",API:"API",IOS:"iOS",WEB:"Web"}},49294:function(e,r,t){t.d(r,{OH:function(){return o},aL:function(){return a},yV:function(){return i}});let n=()=>window.dataLayer?window.dataLayer:null,i=e=>{let r=n();null==r||r.push({event:"user_initialized",user_id:e})},o=(e,r)=>{let t=n();null==t||t.push({event:e,properties:r})},a=()=>{let e=n();null==e||e.push({properties:{ecommerce:null}})}},7809:function(e,r,t){t.d(r,{Sy:function(){return l},WV:function(){return a},j:function(){return i},yV:function(){return o}});let n=()=>window.heap&&"object"==typeof window.heap&&!Array.isArray(window.heap)?window.heap:null,i=(e,r)=>{try{var t;null===(t=n())||void 0===t||t.track(e,r)}catch(e){console.error("Error tracking event with Heap",e)}},o=e=>{try{var r;null===(r=n())||void 0===r||r.identify(e)}catch(e){console.error("Error identifying user with Heap",e)}},a=e=>{try{var r;null===(r=n())||void 0===r||r.addUserProperties(e)}catch(e){console.error("Error adding user properties with Heap",e)}},l=e=>{try{var r;null===(r=n())||void 0===r||r.addEventProperties(e)}catch(e){console.error("Error adding event properties with Heap",e)}}},18807:function(e,r,t){t.d(r,{Sy:function(){return s},WV:function(){return u},dV:function(){return d},j:function(){return a},yV:function(){return l}});var n=t(66925),i=t(49294),o=t(7809);let a=(e,r)=>{o.j(e,r),i.OH(e,r)},l=e=>{o.yV(e),i.yV(e)},u=e=>{o.WV(e)},s=e=>{o.Sy(e)},d=n.J.WEB},54881:function(e,r,t){t.d(r,{lD:function(){return j},$4:function(){return K},zO:function(){return M},f1:function(){return V},wV:function(){return $},kl:function(){return J},gC:function(){return ei},b1:function(){return x},Dc:function(){return q},ZP:function(){return eo},_H:function(){return Q},lo:function(){return Z},_G:function(){return W},gg:function(){return D},j7:function(){return z},no:function(){return er},wX:function(){return ee},jX:function(){return et},ee:function(){return C},j0:function(){return F},hp:function(){return G},U$:function(){return en},_J:function(){return B},LR:function(){return Y}});var n={};t.r(n),t.d(n,{clearDisabledBuyButton:function(){return f},clearModalSettings:function(){return h},clearNoTimingOptions:function(){return U},clearPreparing:function(){return v},clearProcessingBuy:function(){return y},clearProcessingPreview:function(){return I},clearRequestCloseModal:function(){return m},clearRequestOpenModal:function(){return N},clearTargetApiPlan:function(){return c},clearTargetPlan:function(){return d},clearTiming:function(){return p},requestCloseModal:function(){return g},requestOpenModal:function(){return R},setDisabledBuyButton:function(){return _},setDuration:function(){return E},setNoTimingOptions:function(){return P},setPaddleEnvironmentError:function(){return L},setPaddleInitialised:function(){return w},setPaddleLoadScript:function(){return k},setPreparing:function(){return A},setProcessingBuy:function(){return S},setProcessingPreview:function(){return O},setTargetApiPlan:function(){return s},setTargetPlan:function(){return u},setTiming:function(){return T}});var i=t(97281),o=t(93340);let a={duration:void 0,enterpriseApiDuration:t(50571).Q4.MONTHLY,plan:void 0,apiPlan:void 0,timing:void 0,isPreparing:!1,billingCycle:o.planFrequency.MONTHLY,modal:{requestOpen:!1,requestClose:!1,isDisabledBuyButton:!1,isProcessingBuy:!1,isProcessingPreview:!1,noTimingOptions:!1},paddle:{initialised:!1,environmentError:!1,loadScript:!1}};var l=t(3848);let u=(e,r)=>{e.plan=r.payload},s=(e,r)=>{e.apiPlan=r.payload},d=e=>{e.plan=void 0},c=e=>{e.apiPlan=void 0,e.modal.isProcessingBuy=!1},E=(e,r)=>{e.duration=r.payload},T=(e,r)=>{e.timing=r.payload},p=e=>{e.timing=void 0},_=(e,r)=>{e.modal.isDisabledBuyButton=!0},f=e=>{e.modal.isDisabledBuyButton=!1},A=e=>{e.isPreparing=!0},v=e=>{e.isPreparing=!1},S=e=>{e.modal.isProcessingBuy=!0},y=e=>{e.modal.isProcessingBuy=!1},O=e=>{e.modal.isProcessingPreview=!0},I=e=>{e.modal.isProcessingPreview=!1},R=e=>{e.modal.requestOpen=!0},N=e=>{e.modal.requestOpen=!1},g=e=>{e.modal.requestClose=!0},m=e=>{e.modal.requestClose=!1},P=e=>{e.modal.noTimingOptions=!0},U=e=>{e.modal.noTimingOptions=!1},h=e=>{(0,l.vV)(a.modal,e.modal)},w=e=>{e.paddle.initialised=!0},L=e=>{e.paddle.environmentError=!0},k=e=>{e.paddle.loadScript=!0},b=(0,i.oM)({name:"buy",initialState:a,reducers:n}),{setDuration:D,setPreparing:C,clearPreparing:M,setProcessingBuy:F,clearProcessingBuy:H,setProcessingPreview:G,clearProcessingPreview:V,setTargetPlan:B,clearTargetPlan:x,setTiming:Y,clearTiming:q,setDisabledBuyButton:W,clearDisabledBuyButton:j,requestOpenModal:Z,clearRequestOpenModal:J,requestCloseModal:Q,clearRequestCloseModal:$,setNoTimingOptions:z,clearNoTimingOptions:X,clearModalSettings:K,setPaddleInitialised:ee,setPaddleEnvironmentError:er,setPaddleLoadScript:et,setTargetApiPlan:en,clearTargetApiPlan:ei}=b.actions;var eo=b.reducer},3848:function(e,r,t){function n(e,r){for(let t of Object.keys(e))r.hasOwnProperty(t)?e[t]=r[t]:delete e[t]}function i(e,r){for(let t of Object.keys(e))e[t]=r[t]}function o(e,r){if(!e)return r;for(let t of Object.keys(e))r[t]=e[t]}function a(e,r){if(!e)return r;let t={...r};for(let n of Object.keys(r))e.hasOwnProperty(n)&&(t[n]=e[n]);return t}t.d(r,{IW:function(){return i},oA:function(){return n},vU:function(){return a},vV:function(){return o}})},14424:function(e,r,t){t.d(r,{m4:function(){return S},ZP:function(){return y},I$:function(){return v},eq:function(){return f},hS:function(){return _},_6:function(){return A}});var n={};t.r(n),t.d(n,{closeStackedModal:function(){return E},openStackedModal:function(){return c},resetViewed:function(){return s},setHasViewed:function(){return u},setModalData:function(){return d}});var i=t(97281),o=t(8581),a=t(99090),l=t(80954);let u=(e,r)=>{let{modal:t,version:n}=r.payload;e.hasViewed[t]=null==n||n},s=(e,r)=>{e.hasViewed[r.payload.modal]=!1},d=(e,r)=>{r.payload.data?e.data[r.payload.modal]=r.payload.data:delete e.data[r.payload.modal]},c=(e,r)=>{var t;let n=null!==(t=r.payload.priority)&&void 0!==t?t:l.u[r.payload.modal].priority;if(e.stack.find(e=>e.id===r.payload.modal))return;let i=Array.from(e.stack.map(e=>({...e}))),o={id:r.payload.modal,priority:n},a=[],u=[];i.forEach(e=>{(e.priority?a:u).push(e)}),n?(a.push(o),a.sort((e,r)=>{var t,n;return(null!==(t=r.priority)&&void 0!==t?t:0)-(null!==(n=e.priority)&&void 0!==n?n:0)})):u.unshift(o),e.stack=[...a,...u]},E=(e,r)=>{let t=e.stack.findIndex(e=>e.id===r.payload.modal);if(-1===t)return;let n=Array.from(e.stack.map(e=>({...e})));n.splice(t,1),e.stack=n},T={hasViewed:Object.keys(l.Z).reduce((e,r)=>({...e,[r]:!1}),{}),data:{},stack:[]},p=(0,i.oM)({name:"modal",initialState:T,reducers:n}),{setHasViewed:_,resetViewed:f,setModalData:A,openStackedModal:v,closeStackedModal:S}=p.actions;p.reducer;var y=(0,o.OJ)({key:"modals",storage:a.Z,whitelist:["hasViewed","data"]},p.reducer)},80954:function(e,r,t){var n,i;t.d(r,{u:function(){return o}}),(i=n||(n={})).UPDATE="UPDATE",i.UPGRADE="UPGRADE",i.UPDATED_UPGRADE="UPDATED_UPGRADE",i.USER_DETAILS="USER_DETAILS",i.TERMS_OF_SERVICE="TERMS_OF_SERVICE",i.ONBOARDING="ONBOARDING",i.ONBOARDING_GET_STARTED="ONBOARDING_GET_STARTED",i.GET_STARTED_WITH_IMAGE_GENERATION="GET_STARTED_WITH_IMAGE_GENERATION",i.ANNOUNCEMENTS="ANNOUNCEMENTS",i.ALCHEMY_EXPIRED="ALCHEMY_EXPIRED",i.CHANGELOG="CHANGELOG",i.FEATURE_INTRO_ALCHEMY_TRIAL="FEATURE_INTRO_ALCHEMY_TRIAL",i.FEATURE_INTRO_MOTION="FEATURE_INTRO_MOTION",i.FEATURE_INTRO_PHOTO_REAL="FEATURE_INTRO_PHOTO_REAL",i.FEATURE_INTRO_PHOTO_REAL_V2_SPLASH="FEATURE_INTRO_PHOTO_REAL_V2_SPLASH",i.FEATURE_INTRO_ELEMENTS="FEATURE_INTRO_ELEMENTS",i.FEATURE_INTRO_ELEMENTS_SPLASH="FEATURE_INTRO_ELEMENTS_SPLASH",i.FEATURE_INTRO_ALCHEMY_V2_SPLASH="FEATURE_INTRO_ALCHEMY_V2_SPLASH",i.FEATURE_INTRO_MOTION_SPLASH="FEATURE_INTRO_MOTION_SPLASH",i.FEATURE_INTRO_MOTION_INSTRUCTIONS="FEATURE_INTRO_MOTION_INSTRUCTIONS",i.FEATURE_INTRO_UNIVERSAL_UPSCALER="FEATURE_INTRO_UNIVERSAL_UPSCALER",i.FEATURE_INTRO_UNIVERSAL_UPSCALER_SPLASH="FEATURE_INTRO_UNIVERSAL_UPSCALER_SPLASH",i.FEATURE_COLLECTIONS_SPLASH="FEATURE_COLLECTIONS_SPLASH",i.FEATURE_INTRO_GENERATION_V2_INSTRUCTIONS="FEATURE_INTRO_GENERATION_V2_INSTRUCTIONS",i.PROMPT_MAGIC_SETTINGS="PROMPT_MAGIC_SETTINGS",i.ALCHEMY_GENERATIONS_USED="ALCHEMY_GENERATIONS_USED",i.ELEMENTS="ELEMENTS",i.DRAWER_MOBILE_APP_AVAILABILITY="DRAWER_MOBILE_APP_AVAILABILITY",i.SELECT_IMAGE_INPUT="SELECT_IMAGE_INPUT",i.TEAM_INVITES="TEAM_INVITES",i.TEAM_ACCESS_CHANGED="TEAM_ACCESS_CHANGED",i.GENERATION_V2_TOUR="GENERATION_V2_TOUR";let o={UPDATE:{priority:1e3,viewOnce:!0},USER_DETAILS:{priority:100,viewOnce:!1},TERMS_OF_SERVICE:{priority:99,viewOnce:!1},ONBOARDING:{priority:95},ONBOARDING_GET_STARTED:{priority:95},GET_STARTED_WITH_IMAGE_GENERATION:{priority:98,viewOnce:!1},CHANGELOG:{priority:91,viewOnce:!0},ANNOUNCEMENTS:{priority:90,viewOnce:!0},UPGRADE:{priority:85},UPDATED_UPGRADE:{priority:85},ALCHEMY_EXPIRED:{priority:80},FEATURE_INTRO_GENERATION_V2_INSTRUCTIONS:{priority:75,viewOnce:!0,disabled:!1},FEATURE_COLLECTIONS_SPLASH:{priority:75,viewOnce:!1,disabled:!1},FEATURE_INTRO_UNIVERSAL_UPSCALER_SPLASH:{priority:75,viewOnce:!0,disabled:!0},FEATURE_INTRO_ALCHEMY_V2_SPLASH:{priority:70,viewOnce:!0,disabled:!0},FEATURE_INTRO_ELEMENTS_SPLASH:{priority:70,viewOnce:!0},DRAWER_MOBILE_APP_AVAILABILITY:{priority:70},FEATURE_INTRO_PHOTO_REAL_V2_SPLASH:{priority:70,viewOnce:!0,disabled:!0},FEATURE_INTRO_MOTION:{priority:null,viewOnce:!0,disabled:!0},FEATURE_INTRO_MOTION_SPLASH:{priority:null,viewOnce:!0,disabled:!0},FEATURE_INTRO_MOTION_INSTRUCTIONS:{priority:null,viewOnce:!0},FEATURE_INTRO_ALCHEMY_TRIAL:{priority:null,viewOnce:!0,disabled:!0},FEATURE_INTRO_PHOTO_REAL:{priority:null},FEATURE_INTRO_UNIVERSAL_UPSCALER:{priority:null,viewOnce:!0},PROMPT_MAGIC_SETTINGS:{priority:null},ALCHEMY_GENERATIONS_USED:{priority:null},FEATURE_INTRO_ELEMENTS:{priority:null,viewOnce:!0},ELEMENTS:{priority:null},SELECT_IMAGE_INPUT:{priority:null},TEAM_INVITES:{priority:null,viewOnce:!0},TEAM_ACCESS_CHANGED:{priority:null,viewOnce:!1},GENERATION_V2_TOUR:{priority:50,viewOnce:!0}};r.Z=n},45608:function(e,r,t){t.d(r,{EH:function(){return U},NO:function(){return h},Uo:function(){return P},Ww:function(){return R},hk:function(){return I},pZ:function(){return m},rK:function(){return g}});var n=t(77828),i=t(93340),o=t(97281),a=t(6148),l=t(31574),u=t(57919),s=t(8581),d=t(99090),c=t(54881),E=t(3848),T=t(54944),p=t(12088),_=t(50571),f=t(18807),A=t(14424),v=t(80954);let S={apiConcurrencySlots:0,apiCredit:0,apiPaidTokens:void 0,apiPlan:i.API_PLAN_TYPE.FREE,apiPlanAutoTopUpTriggerBalance:0,apiPlanSubscribeDate:void 0,apiPlanSubscribeFrequency:_.Q4.MONTHLY,apiPlanSubscriptionSource:void 0,apiPlanTokenRenewalDate:void 0,apiPlanTopUpAmount:0,apiSubscriptionTokens:void 0,auth0Email:void 0,blocked:!1,error:void 0,firstLoadComplete:!1,id:"",interests:[],interestsRoles:void 0,interestsRolesOther:void 0,isChangelogVisible:!0,lastSeenChangelogId:null,loaded:!1,loadedBalance:!1,paddleId:void 0,paidTokens:0,plan:"FREE",planSubscribeFrequency:_.Q4.YEARLY,selectedTeam:void 0,showNsfw:!1,streamTokens:0,sub:"",subscriptionGptTokens:0,subscriptionModelTokens:0,subscriptionSource:void 0,subscriptionTokens:0,teams:[],tokenRenewalDate:void 0,tosAcceptances:[],username:"",createdAt:void 0,rolloverTokens:0,customApiTokenRenewalAmount:void 0};function y(e){return e&&"object"==typeof e&&"name"in e&&"message"in e&&("stack"in e||"code"in e)}function O(e){if(e instanceof n.cA){let r=Error("ApolloError: "+e.message);a.$e(t=>{t.setTag("apollo","error"),t.setExtra("graphQLErrors",e.graphQLErrors),t.setExtra("networkError",e.networkError),t.setExtra("clientTime",Date.now()),l.Tb(r)})}else if(y(e)){let r=Error("SerializedError: "+(e.message||"Unknown error"));a.$e(t=>{t.setTag("redux","serializedError"),t.setExtra("name",e.name),t.setExtra("code",e.code),t.setExtra("stack",e.stack),t.setExtra("clientTime",Date.now()),l.Tb(r)})}else l.Tb(e);console.error("Error in redux/user:",e)}let I=(0,o.hg)("user/updateUserTokens",async(e,r)=>{let{sub:t}=r.getState().auth.token;u.n({category:"redux.user",message:"Attempting to update the user's token count from remote.",level:"debug"});try{let e=await p.ZP.query({query:T.uS$,variables:{sub:t},fetchPolicy:"network-only"});if(!e.data.user_details[0])throw Error("Error in redux/user/updateUserTokens -> No user data or invalid user data found for user sub provided: ".concat(t));u.n({category:"redux.user",message:"Successfully updated the user's token count from remote.",level:"debug"});let{user_details:[r],teams:n}=e.data;return{userDetails:r,teams:n}}catch(e){return l.Tb(e),r.rejectWithValue("Failed to update user tokens with error: ".concat(JSON.stringify(e)))}}),R=(0,o.hg)("user/updateUserFromDb",async(e,r)=>{let{dispatch:t}=r,n=r.getState(),{sub:o}=n.auth.token;u.n({category:"redux.user",message:"Attempting to update basic user details from remote.",level:"debug"});try{var a,s;let e;let r=await p.ZP.query({query:T.bSP,variables:{userSub:o},fetchPolicy:"network-only"});if(!(null===(s=r.data.users[0])||void 0===s?void 0:null===(a=s.user_details)||void 0===a?void 0:a[0]))throw Error("Error in redux/user/updateUserFromDb -> No user data or invalid user data found for user sub provided: ".concat(o));u.n({category:"redux.user",message:"Successfully updated basic user details from remote.",level:"debug"});let{id:l,username:d,blocked:E,createdAt:S,user_details:[y],team_memberships:O,tos_acceptances:I,suspensionStatus:R}=r.data.users[0];if(!l)throw Error("Error in redux/user/updateUserFromDb -> User found without id! Provided sub: ".concat(o));let N=y.planSubscribeFrequency||_.Q4.YEARLY;u.n({category:"redux.user",message:"Attempting to update user plan details in state.",level:"debug"}),t((0,c.gg)(N)),u.n({category:"redux.user",message:"Attempting to update user teams details.",level:"debug"});let g=O.map(e=>({...e.team,userRole:e.role}));n.user.selectedTeam&&(e=g.find(e=>e.akUUID===n.user.selectedTeam),void 0===e&&(t(m()),n.user.id===l&&t((0,A.I$)({modal:v.Z.TEAM_ACCESS_CHANGED})))),u.n({category:"redux.user",message:"Adding analytics attributes to user session.",level:"debug"}),(0,f.yV)(l),(0,f.WV)({username:d,plan:y.plan,role:y.interestsRoles,teamId:null==e?void 0:e.id,teamName:null==e?void 0:e.teamName,teamPlan:null==e?void 0:e.plan,teamPlanSeats:null==e?void 0:e.planSeats});let P=E&&!(R===i.SUSPENSION_STATUS_TYPE.TEMPORARILY_SUSPENDED||R===i.SUSPENSION_STATUS_TYPE.WARNING);return{...y,id:l,username:d,sub:o,planSubscribeFrequency:N,blocked:P,teams:g,tosAcceptances:I,createdAt:S}}catch(e){return l.Tb(e),r.rejectWithValue(e)}}),N=(0,o.oM)({name:"user",initialState:S,reducers:{reset:e=>{(0,E.oA)(e,S)},setUserError:(e,r)=>{y(r.payload)?e.error=r.payload:e.error=Error("Unknown error during app setup")},resetUserError:e=>{e.error=void 0},setSelectedTeam:(e,r)=>{var t;let n=null===(t=e.teams)||void 0===t?void 0:t.find(r=>r.akUUID===e.selectedTeam);(0,f.WV)({teamId:null==n?void 0:n.id,teamName:null==n?void 0:n.teamName,teamPlan:null==n?void 0:n.plan,teamPlanSeats:null==n?void 0:n.planSeats}),e.selectedTeam=r.payload},resetSelectedTeam:e=>{e.selectedTeam=void 0,(0,f.WV)({teamId:void 0,teamName:void 0,teamPlan:void 0,teamPlanSeats:void 0})},setLastSeenChangelogId:(e,r)=>{e.lastSeenChangelogId=r.payload}},extraReducers:e=>{e.addCase(R.pending,e=>{e.loaded=!1}),e.addCase(R.fulfilled,(e,r)=>{(0,E.vV)(r.payload,e),e.loaded=!0,e.firstLoadComplete=!0}),e.addCase(R.rejected,(e,r)=>{e.loaded=!0,e.firstLoadComplete=!0,e.error=r.error,console.error("Error in redux/user/updateUserFromDb:",r.error,e.error),O(r.error),O(e.error)}),e.addCase(I.pending,e=>{e.loadedBalance=!1}),e.addCase(I.fulfilled,(e,r)=>{(0,E.vV)(r.payload.userDetails,e),r.payload.teams&&r.payload.teams.map(r=>{var t;let n=null===(t=e.teams)||void 0===t?void 0:t.find(e=>r.akUUID===e.akUUID);n&&(0,E.vV)(r,n)}),e.loadedBalance=!0}),e.addCase(I.rejected,(e,r)=>{e.loadedBalance=!0,e.error=r.error,e.error?O(e.error):O(Error("Error in redux/user/updateUserTokens but no error was provided."))})}}),{setSelectedTeam:g,resetSelectedTeam:m,setLastSeenChangelogId:P,setUserError:U,resetUserError:h}=N.actions;r.ZP=(0,s.OJ)({version:.1,key:"user",whitelist:["id","selectedTeam","teams"],storage:d.Z},N.reducer)}}]);